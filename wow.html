<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Linktree GraphQL Explorer</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: #0d1117; 
      color: #c9d1d9; 
      padding: 20px; 
    }
    .container { 
      background: #161b22; 
      border: 1px solid #30363d; 
      border-radius: 8px; 
      padding: 20px; 
      margin: 10px;
    }
    button { 
      background-color: #238636; 
      color: white; 
      border: none; 
      padding: 10px 15px; 
      margin: 5px;
      border-radius: 4px; 
      cursor: pointer; 
    }
    button:hover { 
      background-color: #2ea043; 
    }
    #output { 
      background: #0d1117; 
      padding: 15px; 
      border-radius: 4px; 
      border: 1px solid #30363d; 
      color: #7ee787; 
      font-family: monospace; 
      white-space: pre-wrap; 
      max-height: 400px; 
      overflow-y: auto;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>üîç GraphQL Schema Discovery</h2>
  <button onclick="discoverRootFields()">Discover Root Fields</button>
  <button onclick="tryCommonQueries()">Try Common Queries</button>
  <button onclick="findUserQueries()">Find User Queries</button>
  <div id="output">Ready to explore...</div>
</div>

<script>
  async function sendQuery(query) {
    const url = `https://graph.linktr.ee/graphql?query=${encodeURIComponent(query)}`;
    try {
      const response = await fetch(url, {
        method: 'GET',
        credentials: 'include'
      });
      return await response.json();
    } catch (error) {
      return { error: error.toString() };
    }
  }

  async function discoverRootFields() {
    const output = document.getElementById('output');
    output.innerHTML = 'Discovering root fields...\n';
    
    // Simple query to get top-level fields
    const query = `
      query {
        __schema {
          queryType {
            fields {
              name
              description
            }
          }
        }
      }
    `;
    
    const result = await sendQuery(query);
    output.innerHTML = JSON.stringify(result, null, 2);
  }

  async function tryCommonQueries() {
    const output = document.getElementById('output');
    output.innerHTML = 'Trying common query patterns...\n';
    
    const commonQueries = [
      'query { __typename }',
      'query { me { __typename } }',
      'query { user { __typename } }',
      'query { currentUser { __typename } }',
      'query { profile { __typename } }',
      'query { account { __typename } }'
    ];
    
    for (let query of commonQueries) {
      output.innerHTML += `\nTrying: ${query}\n`;
      const result = await sendQuery(query);
      output.innerHTML += JSON.stringify(result, null, 2) + '\n---\n';
      await new Promise(resolve => setTimeout(resolve, 500)); // Small delay
    }
  }

  async function findUserQueries() {
    const output = document.getElementById('output');
    output.innerHTML = 'Searching for user-related queries...\n';
    
    // Try to get the full schema
    const introspectionQuery = `
      query IntrospectionQuery {
        __schema {
          types {
            name
            kind
            fields {
              name
            }
          }
        }
      }
    `;
    
    const result = await sendQuery(introspectionQuery);
    
    if (result.data && result.data.__schema) {
      // Look for types that might contain user data
      const types = result.data.__schema.types;
      const userTypes = types.filter(type => 
        type && type.name && (
          type.name.toLowerCase().includes('user') ||
          type.name.toLowerCase().includes('profile') ||
          type.name.toLowerCase().includes('account')
        )
      );
      
      output.innerHTML = `Found potential user types:\n${JSON.stringify(userTypes.map(t => t.name), null, 2)}\n\n`;
      
      // Try querying these types
      for (let type of userTypes) {
        if (type.name) {
          const testQuery = `query { ${type.name} { __typename } }`;
          output.innerHTML += `\nTesting: ${testQuery}\n`;
          const testResult = await sendQuery(testQuery);
          output.innerHTML += JSON.stringify(testResult, null, 2) + '\n';
        }
      }
    } else {
      output.innerHTML = 'Introspection failed: ' + JSON.stringify(result, null, 2);
    }
  }
</script>
</body>
</html>
